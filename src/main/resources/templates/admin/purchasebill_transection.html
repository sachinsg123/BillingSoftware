<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org" th:replace="fragments/base::layout(~{::section})">
<!-- Created by Younus -->
<section>
<script src="https://kit.fontawesome.com/0faddc1af8.js" crossorigin="anonymous"></script>
<script>
    function deleteContactAlert(id) {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: false
        })

        swalWithBootstrapButtons.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'No, cancel!',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                window.location = "/a2zbilling/admin/purchasebill/delete/" + id + " ";

                swalWithBootstrapButtons.fire(
                    'Purchase Bill Transection Deleted Successfully!'
                )
            } else if (
                result.dismiss === Swal.DismissReason.cancel
            ) {
                swalWithBootstrapButtons.fire(
                    'Cancelled',
                    'Purchase Bill Transection Not deleted',
                    'error'
                )
            }
        })
    }

    function filterTable() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            let match = false;
            cells.forEach(cell => {
                if (cell.textContent.toLowerCase().includes(query)) {
                    match = true;
                }
            });
            row.style.display = match ? '' : 'none';
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('searchInput').addEventListener('keyup', filterTable);
    });
</script>
<style>
    .table tbody tr:hover {
        background-color: #e0e0e0;
        color: #000;
    }
    .search-icon {
        cursor: pointer;
    }
</style>
<div class="container-fluid">
    <div th:if="${session.message}">
        <div class="alert alert-primary" role="alert">
            <p th:text="${session.message}"></p>
            <script th:inline="javascript">
                setTimeout(function () {
                    window.location.href = '/a2zbilling/admin/clearSessionAttribute';
                }, 500);
            </script>
        </div>
    </div>
    <div class="row" style="background-color: rgb(84,78,130); color: #fff;">
        <div class="col-md-12 mt-1">
            <h1 class="text-center">Purchase Transaction</h1>
        </div>
    </div>
    <div style="background-color: #f5f0f0;">
        <div class="row pb-3">
            <div class="col-md-6">
                <form th:action="@{/search}" method="get">
                    <div class="col-md-6">
                        <!-- Search Bar -->
                        <input id="searchInput" type="text" style="margin-top: 20px; height: 35px; width: 200px; border-radius: 10px; border-color: rgb(12,131,226);" name="query" placeholder=" Search">
                        <!-- Search icon -->
                        
                    </div>
                </form>
            </div>
            <div class="col-md-6 mt-3" style="text-align: right;">
                <a th:href="@{'/a2zbilling/admin/purchasebill/add'}" class="btn btn-info"><i class="fa-solid fa-circle-plus"></i> Add Purchase</a>
            </div>
        </div>
        <div class="row mt-2 pb-3">
            <div class="col-md-12">
                <table class="table table-bordered" style="background-color: #fff;">
                    <thead style="background-color: #696969;color: #fff;">
                        <tr>
                            <th scope="col">Date</th>
                            <th scope="col">Invoice No</th>
                            <th scope="col">Party Name</th>
                            <th scope="col">Product Name</th>
                            <th scope="col">Quantity</th>
                            <!--<th scope="col">Tax Status</th>-->
                            <th scope="col">Discount Amount</th>
                            <th scope="col">Payment Type</th>
                            <th scope="col">Net Payment</th>
                            <th scope="col">Balance Due</th>
                            <th scope="col">Amount Paid</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="party : ${partiesTransactions.content}" style="text-align: center; border: 1px solid black;">
                            <td th:text="${party.date}"><input type="text" class="form-control" value="" readonly></td>
                            <td th:text="${party.billNo}"><input class="form-control" value="" readonly></td>
                            <td th:text="${party.parties?.name}"><input class="form-control" value="" readonly></td>
                            <td>
                                <ul style="list-style-type: none; padding: 0; margin: 0;">
                                    <li th:each="product : ${party?.products}">
                                        <span th:text="${product?.name}"></span>
                                    </li>
                                </ul>
                            </td>
                            <td th:text="${party?.quantity}"><input class="form-control" value="" readonly></td>
                            <!--<td>
                                <select class="form-control">
                                    <option value="including_tax">Including Tax</option>
                                    <option value="excluding_tax">Excluding Tax</option>
                                </select>
                            </td>-->
                            <td th:text="${party.discountInRupees}"><input type="text" class="form-control" value="" readonly></td>
                            <td th:text="${party.paymentMode}"><input type="text" class="form-control" value="" readonly></td>
                            <td th:text="${party.netPayment}"><input type="text" class="form-control" value="" readonly></td>
                            <td th:text="${party.dues}"><input type="text" class="form-control" value="" readonly></td>
                            <td th:text="${party.paid}"><input type="text" class="form-control" value="" readonly></td>
                        </tr>
                    </tbody>
                </table>
				<div>
			        <span th:text="'Page ' + ${currentPage + 1} + ' of ' + ${partiesTransactions.totalPages}"></span>
			     </div>
			     <div>
			        <a th:if="${partiesTransactions.hasPrevious()}" th:href="@{/a2zbilling/admin/purchasebill/transection(page=${currentPage - 1}, size=${partiesTransactions.size})}">Previous</a>
			        <a th:if="${partiesTransactions.hasNext()}" th:href="@{/a2zbilling/admin/purchasebill/transection(page=${currentPage + 1}, size=${partiesTransactions.size})}">Next</a>
			    </div>
            </div>
        </div>
    </div>
</div>
</section>
</body>
<!-- END Body -->
</html>
